<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Integration Fixes Test</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--color-background);
            color: var(--color-text-primary);
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-pass {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .test-fail {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .test-warn {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        button {
            background: var(--color-accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        #console-output {
            background: #1a1a1a;
            color: #ffffff;
            font-family: monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 4px;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>App Integration Fixes Test</h1>
        <p>Testing the fixes for App component integration issues.</p>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <button onclick="runFixTests()">Run Fix Tests</button>
            <button onclick="testErrorHandling()">Test Error Handling</button>
            <button onclick="testPerformanceIntegration()">Test Performance Integration</button>
            <button onclick="clearConsole()">Clear Console</button>
        </div>
        
        <div class="test-section">
            <h2>Test Results</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Console Output</h2>
            <div id="console-output">Waiting for tests...</div>
        </div>
        
        <!-- Minimal portfolio structure for testing -->
        <div style="display: none;">
            <header id="header"></header>
            <section id="hero" class="section"><h1 id="hero-title"></h1><p id="hero-subtitle"></p><div id="hero-contact"></div></section>
            <section id="about" class="section"><h2 id="about-title"></h2><img id="about-headshot"><p id="about-bio"></p></section>
            <section id="summary" class="section"><h2 id="summary-title"></h2><p id="summary-text"></p></section>
            <section id="experience" class="section"><h2 id="experience-title"></h2><div id="experience-timeline"></div></section>
            <section id="projects" class="section"><h2 id="projects-title"></h2><div id="projects-grid"></div></section>
            <section id="skills" class="section"><h2 id="skills-title"></h2><div id="skills-categories"></div></section>
            <section id="contact" class="section"><h2 id="contact-title"></h2><div id="contact-links"></div></section>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/performance.js"></script>
    <script src="js/critical-css.js"></script>
    <script src="js/types.js"></script>
    <script src="js/data.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/animations.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        let testResults = [];
        
        // Capture console output
        const consoleOutput = document.getElementById('console-output');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        function logToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            consoleOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = (...args) => {
            originalConsoleLog.apply(console, args);
            logToConsole(args.join(' '));
        };
        
        console.error = (...args) => {
            originalConsoleError.apply(console, args);
            logToConsole(args.join(' '), 'error');
        };
        
        console.warn = (...args) => {
            originalConsoleWarn.apply(console, args);
            logToConsole(args.join(' '), 'warn');
        };
        
        function addTestResult(name, passed, message) {
            testResults.push({ name, passed, message });
            
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.textContent = `${passed ? '‚úÖ' : '‚ùå'} ${name}: ${message}`;
            resultsDiv.appendChild(resultDiv);
        }
        
        function addWarning(name, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result test-warn';
            resultDiv.textContent = `‚ö†Ô∏è ${name}: ${message}`;
            resultsDiv.appendChild(resultDiv);
        }
        
        async function runFixTests() {
            console.log('üß™ Running App Integration Fix Tests...');
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
            
            // Wait for app to be available
            await waitForApp();
            
            // Test 1: App initialization without errors
            testAppInitialization();
            
            // Test 2: Performance optimizer integration
            testPerformanceOptimizerIntegration();
            
            // Test 3: Data loading resilience
            testDataLoadingResilience();
            
            // Test 4: Component registration
            testComponentRegistration();
            
            // Test 5: Error recovery
            testErrorRecovery();
            
            console.log('‚úÖ Fix tests completed');
        }
        
        async function waitForApp() {
            let attempts = 0;
            while (!window.portfolioApp && attempts < 50) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            if (!window.portfolioApp) {
                addTestResult('App Availability', false, 'App not available after 5 seconds');
                return false;
            }
            
            addTestResult('App Availability', true, 'App instance is available');
            return true;
        }
        
        function testAppInitialization() {
            const app = window.portfolioApp;
            
            // Test app instance
            addTestResult(
                'App Instance Type',
                app instanceof window.App,
                'App is instance of App class'
            );
            
            // Test load status
            addTestResult(
                'App Load Status',
                app.isLoaded === true,
                `App load status: ${app.isLoaded}`
            );
            
            // Test components map
            addTestResult(
                'Components Map',
                app.components instanceof Map && app.components.size > 0,
                `Components registered: ${app.components.size}`
            );
        }
        
        function testPerformanceOptimizerIntegration() {
            const app = window.portfolioApp;
            
            // Test performance optimizer reference
            if (window.performanceOptimizer) {
                addTestResult(
                    'Performance Optimizer Available',
                    true,
                    'Performance optimizer is available globally'
                );
                
                addTestResult(
                    'Performance Optimizer Reference',
                    app.performance === window.performanceOptimizer,
                    'App has correct performance optimizer reference'
                );
                
                // Test method availability
                const hasInitLazyLoading = typeof app.performance.initLazyLoading === 'function';
                addTestResult(
                    'Lazy Loading Method',
                    hasInitLazyLoading,
                    `initLazyLoading method ${hasInitLazyLoading ? 'available' : 'missing'}`
                );
            } else {
                addWarning('Performance Optimizer', 'Performance optimizer not available');
            }
        }
        
        function testDataLoadingResilience() {
            // Test portfolio data
            if (window.portfolioData) {
                addTestResult(
                    'Portfolio Data Manager',
                    true,
                    'Portfolio data manager is available'
                );
                
                addTestResult(
                    'Data Load Status',
                    window.portfolioData.isLoaded,
                    `Data loaded: ${window.portfolioData.isLoaded}`
                );
                
                // Test fallback data availability
                const personalData = window.portfolioData.getPersonalInfo();
                addTestResult(
                    'Fallback Data',
                    personalData && personalData.name,
                    'Fallback data is available'
                );
            } else {
                addTestResult('Portfolio Data Manager', false, 'Portfolio data manager not found');
            }
        }
        
        function testComponentRegistration() {
            const app = window.portfolioApp;
            const expectedComponents = ['hero', 'about', 'summary', 'experience', 'projects', 'skills', 'contact'];
            
            expectedComponents.forEach(componentName => {
                const component = app.getComponent(componentName);
                addTestResult(
                    `Component: ${componentName}`,
                    component && component.element,
                    component ? 'Registered with element' : 'Not registered'
                );
            });
        }
        
        function testErrorRecovery() {
            const app = window.portfolioApp;
            
            // Test invalid component refresh
            const invalidRefresh = app.refreshComponent('nonexistent');
            addTestResult(
                'Invalid Component Handling',
                invalidRefresh === false,
                'Invalid component refresh handled gracefully'
            );
            
            // Test public API methods
            try {
                const allComponents = app.getAllComponents();
                addTestResult(
                    'Public API - getAllComponents',
                    Array.isArray(allComponents),
                    `Returns array with ${allComponents.length} components`
                );
            } catch (error) {
                addTestResult(
                    'Public API - getAllComponents',
                    false,
                    `Error: ${error.message}`
                );
            }
        }
        
        async function testErrorHandling() {
            console.log('üß™ Testing Error Handling...');
            
            // Test with temporarily broken data
            const originalLoadData = window.portfolioData.loadData;
            window.portfolioData.loadData = () => Promise.reject(new Error('Simulated network error'));
            
            try {
                await window.portfolioApp.loadPortfolioDataWithRetry(1);
                addTestResult('Error Handling', true, 'Gracefully handled data loading error');
            } catch (error) {
                addTestResult('Error Handling', false, `Unhandled error: ${error.message}`);
            }
            
            // Restore original method
            window.portfolioData.loadData = originalLoadData;
        }
        
        function testPerformanceIntegration() {
            console.log('üß™ Testing Performance Integration...');
            
            if (window.performanceOptimizer) {
                // Test performance methods
                const methods = ['checkWebPSupport', 'getOptimizedImageUrl', 'loadImage'];
                methods.forEach(method => {
                    addTestResult(
                        `Performance Method: ${method}`,
                        typeof window.performanceOptimizer[method] === 'function',
                        `Method ${method} is available`
                    );
                });
            } else {
                addWarning('Performance Integration', 'Performance optimizer not loaded');
            }
        }
        
        function clearConsole() {
            consoleOutput.textContent = 'Console cleared.\n';
            document.getElementById('test-results').innerHTML = '';
            testResults = [];
        }
        
        // Auto-run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runFixTests, 2000);
        });
    </script>
</body>
</html>